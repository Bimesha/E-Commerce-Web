USE oakly_web;

CREATE TABLE `User` (
  `UserID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `FirstName` VARCHAR(255) NOT NULL,
  `LastName` VARCHAR(255) NOT NULL,
  `Email` VARCHAR(255) NOT NULL,
  `Password` VARCHAR(255) NOT NULL,
  `Address` VARCHAR(255),
  `Phone` VARCHAR(20),
  `ProfilePicture` VARCHAR(255),
  `Role` ENUM('Admin', 'User') NOT NULL DEFAULT 'User',
  PRIMARY KEY (`UserID`),
  UNIQUE (`Email`),
  UNIQUE (`Phone`)
) ENGINE=InnoDB;

CREATE TABLE `Category` (
  `CategoryID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `CategoryName` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`CategoryID`)
) ENGINE=InnoDB;

CREATE TABLE `Product` (
  `ProductID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `Name` VARCHAR(255) NOT NULL,
  `Description` TEXT,
  `Price` DECIMAL(10,2) NOT NULL,
  `Quantity` INT UNSIGNED NOT NULL,
  `CategoryID` INT UNSIGNED,
  PRIMARY KEY (`ProductID`),
  FOREIGN KEY (`CategoryID`) REFERENCES `Category`(`CategoryID`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB;

CREATE TABLE `Cart` (
  `CartID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `UserID` INT UNSIGNED NOT NULL,
  `ProductID` INT UNSIGNED NOT NULL,
  `CQuantity` INT UNSIGNED NOT NULL,
  `TotalPrice` DECIMAL(10,2) NOT NULL,
  PRIMARY KEY (`CartID`),
  FOREIGN KEY (`UserID`) REFERENCES `User`(`UserID`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`ProductID`) REFERENCES `Product`(`ProductID`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB;

CREATE TABLE `Order` (
  `OrderID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `UserID` INT UNSIGNED NOT NULL,
  `ShippingID` INT UNSIGNED NOT NULL,  -- Link to ShippingAddress table
  `OrderDate` DATETIME NOT NULL,
  `Status` VARCHAR(50) NOT NULL,
  `TotalAmount` DECIMAL(10,2) NOT NULL,
  `OQuantity` INT UNSIGNED NOT NULL,
  `PaymentMethod` VARCHAR(50) NOT NULL,
  PRIMARY KEY (`OrderID`),
  FOREIGN KEY (`UserID`) REFERENCES `User`(`UserID`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`ShippingID`) REFERENCES `ShippingAddress`(`ShippingID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

CREATE TABLE `ShippingAddress` (
  `ShippingID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `UserID` INT UNSIGNED NOT NULL,
  `FullName` VARCHAR(255) NOT NULL,
  `AddressLine` VARCHAR(255) NOT NULL,
  `City` VARCHAR(100) NOT NULL,
  `State` VARCHAR(100) NOT NULL,
  `ZipCode` VARCHAR(20) NOT NULL,
  `Country` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`ShippingID`),
  FOREIGN KEY (`UserID`) REFERENCES `User`(`UserID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

CREATE TABLE `OrderItem` (
  `OrderItemID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `OrderID` INT UNSIGNED NOT NULL,
  `ProductID` INT UNSIGNED NOT NULL,
  `OIQuantity` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`OrderItemID`),
  FOREIGN KEY (`OrderID`) REFERENCES `Order`(`OrderID`) ON DELETE CASCADE ON UPDATE CASCADE,
  FOREIGN KEY (`ProductID`) REFERENCES `Product`(`ProductID`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB;

CREATE TABLE `Review` (
  `ReviewID` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `UserID` INT UNSIGNED NOT NULL,
  `Comment` TEXT,
  PRIMARY KEY (`ReviewID`),
  FOREIGN KEY (`UserID`) REFERENCES `User`(`UserID`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB;

ALTER TABLE `Product`
ADD COLUMN `ImagePath` VARCHAR(255) NOT NULL;


